@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}
@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Kiểm tra trạng thái đăng nhập khi trang được tải
        window.onload = function () {
            // Lấy token từ localStorage
            var token = localStorage.getItem('authToken');  // Hoặc sessionStorage.getItem('userToken')

            if (!token) {
                // Nếu không có token, chuyển hướng đến trang đăng nhập
                window.location.href = '/Auth/Login';  // Đường dẫn đến trang đăng nhập của bạn
            } else {
                // Nếu có token, gọi API để lấy thông tin người dùng
                    fetch('https://localhost:7199/api/identity/currentUser', {
                        method: 'GET',
                        headers: {
                            'Authorization': 'Bearer ' + token
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        // Kiểm tra xem người dùng có vai trò Admin không
                        if (data.roles && data.roles.includes('Admin')) {
                            // Nếu có vai trò Admin, chuyển hướng đến trang Admin
                            window.location.href = '/Admin';  // Đường dẫn đến trang Admin
                        } else {
                            // Nếu không có vai trò Admin, vẫn cho phép truy cập trang hiện tại
                            console.log('Người dùng không phải Admin');
                            window.location.href = '/Client';
                        }
                    })
                    .catch(error => {
                        console.error('Lỗi khi lấy thông tin người dùng:', error);
                        window.location.href = '/Auth/Login';  // Nếu có lỗi, chuyển hướng về trang login
                    });
            }
        };
    </script>

 } 